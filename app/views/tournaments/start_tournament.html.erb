<% provide(:title, "#{@tournament.name}") %>

<% @tournament.setup_matches %>

<h1>Matches</h1>
<% match_number = 1 %>

<ul id="matches-list">
    <% @tournament.matches.each do |m| %>
        <div id="match-<%= m.id %>" class="match">
            <lh>Match <%= match_number %></lh>
            <% winner_id = m.winner_id %>

            <% p1 = m.player1 if m.player1_id != 0 %>
            <% p2 = m.player2 if m.player2_id != 0 %>

            <% if p1 && p2 && winner_id != 0 %>

                <% if winner_id == p1.id %>
                    <% p1_is_winner = true %>
                <% else %>
                    <% p2_is_winner = true %>
                <% end %>
            <% end %>


            <li class="<% if winner_id != 0 %>
                            <%= p1_is_winner ? "match-winner" : "match-loser" %>
                       <% end %>">
                Player 1 : <%= p1 ? "#{p1.first_name} #{p1.last_name}" : ""  %>
                <% if winner_id == 0 && p1 %>
                    <button class="winner-button" data-match-id="<%= m.id %>" data-player-id="<%= p1.id if p1%>" data-round-id="<%= m.round %>"
                            data-match-number="<%= match_number %>" data-player-number="1">Winner?</button></li>
                <% end %>
            <li class="<% if winner_id != 0 %>
                            <%= p2_is_winner ? "match-winner" : "match-loser" %>
                       <% end %>">
                Player 2 : <%= p2 ? "#{p2.first_name} #{p2.last_name}" : ""  %>
                <% if winner_id == 0 && p2 %>
                    <button class="winner-button" data-match-id="<%= m.id %>" data-player-id="<%= p2.id if p2%>" data-round-id="<%= m.round %>"
                            data-match-number="<%= match_number %>" data-player-number="2">Winner?</button></li>
                <% end %>
            <li>Round <%= m.round %></li>

            <% if winner_id != 0 %>
                <% winner = m.winner %>
            <% end %>
            <li>Winner: <%= "#{winner.first_name} #{winner.last_name}" if winner %></li>
            <br />
            <% match_number = match_number + 1 %>
        </div>
    <% end %>
</ul>

<h2 id="tournament-winner-<%= @tournament.id %>">Tournament Winner: <%= @tournament.winner_id != 0 ? "#{@tournament.winner.first_name}" + " " + "#{@tournament.winner.last_name}" : "" %></h2>


